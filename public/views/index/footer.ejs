<script async type="module">

import { DiscordSDK } from "https://unpkg.com/@discord/embedded-app-sdk@1.0.0/output/index.mjs";

import { config } from "../../../lib/config";

const discordSdk = new DiscordSDK(config.discord.clientID);

async function setup() {
    await discordSdk.ready();

    const {code} = await discordSdk.commands.authorize({
        client_id: config.discord.clientID,
        response_type: 'code',
        state: '',
        prompt: '',
        scope: ['identify','guilds','rpc.voice.read','email','connections','guilds.members.read','rpc.activities.write'],
    });
    const response = await fetch(`https://discord.com/api/oauth2/token`, {
        method: 'POST',
        headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({
            client_id: config.discord.clientID,
            client_secret: config.discord.clientSecret,
            grant_type: 'authorization_code',
            code: code,
        }),
    });

    const {access_token} = await response.json()

    const auth = await discordSdk.commands.authenticate({
        access_token,
    });

    window.discordAuth = auth;
    await discordSdk.commands.encourageHardwareAcceleration();
/*        await discordSdk.commands.setActivity({
        activity: {
            type: 0,
            details: 'Exploring the world',
            state: 'Playing Traveler',
            assets: {
                large_image: "embedded_cover",
                large_text: "Traveler",
                small_image: "world00-lostisland",
                small_text: "Playing Traveler"
            }
        },
    });*/
}

await setup();
</script>

<%- include('../build/cover-pack-scripts') %>
