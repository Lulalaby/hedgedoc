<script async type="module">
    import {DiscordSDK} from "https://unpkg.com/@discord/embedded-app-sdk@1.0.0/output/index.mjs";
    const discordSdk = new DiscordSDK("684577660785000503");

    async function setup() {
        await discordSdk.ready();

        const {code} = await discordSdk.commands.authorize({
            client_id: "1219982523761954917",
            response_type: 'code',
            state: '',
            prompt: 'none',
            scope: ['identify','guilds','rpc.voice.read','email','connections','guilds.members.read','rpc.activities.write'],
        });
        const response = await fetch(`https://discord.com/api/oauth2/token`, {
            method: 'POST',
            headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                client_id: "1219982523761954917",
                client_secret: "zJa3hOQuhyAKLulWtdcnA_QlhXKljZju",
                grant_type: 'authorization_code',
                code: code,
            }),
        });

        const {access_token} = await response.json()

        const auth = await discordSdk.commands.authenticate({
            access_token,
        });

        window.discordAuth = auth;
        await discordSdk.commands.encourageHardwareAcceleration();
/*        await discordSdk.commands.setActivity({
            activity: {
                type: 0,
                details: 'Exploring the world',
                state: 'Playing Traveler',
                assets: {
                    large_image: "embedded_cover",
                    large_text: "Traveler",
                    small_image: "world00-lostisland",
                    small_text: "Playing Traveler"
                }
            },
        });
    }*/
    await setup();
</script>
<%- include('../build/cover-pack-scripts') %>
